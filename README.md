# vexa-ai

## تنظیم و استفاده از GPT

برای فعال‌سازی دستیار GPT داخل ربات تلگرام متغیرهای محیطی زیر را مقداردهی کنید:

- `GPT_API` یا `GPT_API_KEY` یا `OPENAI_API_KEY` — کلید دسترسی به سرویس GPT (الزامی).
- `GPT_MODE` — نوع سرویس GPT؛ مقدار `assistant` از OpenAI Assistants/Responses استفاده می‌کند (پیش‌فرض `chat`).
- `GPT_API_URL` — آدرس سرویس چت؛ برای حالت `assistant` به‌صورت پیش‌فرض `https://api.openai.com/v1/responses` است.
- `GPT_MODEL` — نام مدل، پیش‌فرض `gpt-5-nano`.
- `GPT_API_TIMEOUT` — زمان انتظار درخواست بر حسب ثانیه، پیش‌فرض `45`.
- `GPT_API_KEY_HEADER` و `GPT_API_KEY_PREFIX` — در صورت نیاز به هدر سفارشی برای کلید.
- `GPT_SYSTEM_PROMPT` — پیام سیستمی برای شروع هر مکالمه (پیش‌فرض: «You are Vexa GPT-5…»).
- `GPT_HISTORY_LIMIT` — تعداد پیام‌های اخیر که در هر پاسخ به GPT ارسال می‌شود (پیش‌فرض `6`).
- `GPT_TEMPERATURE` — میزان خلاقیت پاسخ‌ها (۰ تا ۲، پیش‌فرض `0.7`).
- `GPT_TOP_P` — مقدار `top_p` برای نمونه‌گیری هسته‌ای (۰ تا ۱، پیش‌فرض `1`).
- `GPT_MAX_TOKENS` — سقف توکن برای هر پاسخ (۰ یعنی بدون محدودیت جداگانه).
- `GPT_ASSISTANT_ID` — در صورت استفاده از Assistants API می‌توانید شناسه دستیار از پیش ساخته‌شده را وارد کنید (اختیاری). در صورت تنظیم نشدن این متغیر، مقدار `ASSISTANT_ID` (در Secrets) یا `OPENAI_ASSISTANT_ID` نیز به‌صورت خودکار خوانده می‌شود.

در صورتی که بخواهید ربات از OpenAI Assistant/Responses استفاده کند، کافی است متغیر `GPT_MODE=assistant` را تنظیم کنید. در این حالت، پیام‌ها همانند قبل از تاریخچه محلی ساخته شده و به اندپوینت جدید (`/v1/responses`) ارسال می‌شوند و در صورت وجود `GPT_ASSISTANT_ID` همان دستیار از پیش ساخته‌شده اجرا خواهد شد.

## امکانات ربات

- دستور `/gpt` برای شروع گفت‌وگوی مستقیم با GPT در همان چت تلگرام. با دستور `/endgpt` می‌توانید مکالمه را پایان دهید و دکمه «شروع چت جدید ♻️» تاریخچه را پاک می‌کند.
- در منوی اصلی، دکمه GPT شما را به گفت‌وگوی درون ربات هدایت می‌کند.

پس از مقداردهی متغیرها، ربات آماده است تا پیام‌های کاربران را به سرویس GPT ارسال کرده و پاسخ را داخل تلگرام نمایش دهد.

## API خارجی برای تولید عکس و صدا

هر کاربر می‌تواند از داخل منوی اصلی ربات، بخش «API Token» را باز کند و کلید اختصاصی خودش را ببیند یا تعویض کند. این کلید برای احراز هویت درخواست‌های HTTP استفاده می‌شود.

### نحوه اجرا

```bash
uvicorn api_server:app --host 0.0.0.0 --port 8000
```

### احراز هویت

در هر درخواست هدر زیر را ارسال کنید:

```
X-API-Key: <TOKEN>
```

### اندپوینت‌ها

| متد | مسیر       | توضیح | هزینه |
|-----|------------|-------|-------|
| POST | `/v1/image` | تولید تصویر Vexa | ۵ کردیت |
| POST | `/v1/tts`   | تبدیل متن به صدا (صداهای پیش‌فرض) | ۰٫۰۵ کردیت برای هر کاراکتر |
| GET  | `/v1/voices` | فهرست صداهای قابل استفاده | ۰ |

خروجی `POST /v1/image` لینک مستقیم تصویر است. خروجی `POST /v1/tts` شامل محتوای صوتی base64 و موجودی باقی‌ماندهٔ کاربر می‌شود. تمام هزینه‌ها از همان موجودی کردیت حساب تلگرام کسر خواهد شد.
